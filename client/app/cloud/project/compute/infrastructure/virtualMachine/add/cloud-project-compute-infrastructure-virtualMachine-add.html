<section class="container-fluid cui-page__content cui-page__content-flex">

    <div class="row d-lg-flex">
        <div class="col-md-9">

            <cui-wizard-form data-form-title="{{ 'cpcivm_add_title' | translate }}"
                             data-form-on-init="$ctrl.initProject()"
                             data-form-on-cancel="$ctrl.cancel()"
                             data-form-on-complete="$ctrl.confirm()"
                             data-form-completed-text="{{ 'cpcivm_add_button_completed_text' | translate }}"
                             data-form-submitted="$ctrl.loaders.adding">

                <!-- Step 1 : OS or SnapShot -->
                <cui-wizard-step data-step-title="{{ 'cpcivm_add_step1_title' | translate }}"
                                 data-step-on-init="!$ctrl.isLoaded && $ctrl.initOsList()"
                                 data-step-loaded="!$ctrl.loaders.step1"
                                 data-step-completed="$ctrl.isStep1Valid()">

                    <div data-ng-if="!$ctrl.model.imageType && !$ctrl.model.snapshotId">
                        <uib-tabset>
                            <uib-tab index="0" heading="{{ 'cpcivm_add_step1_tab_os' | translate }}">
                                <div class="mt-4">
                                    <div class="cloud-vm-add-list d-md-flex flex-wrap"
                                         data-ng-repeat="(imageType, distributions) in $ctrl.displayedImages track by imageType">
                                        <div class="oui-radio oui-radio_thumbnail cloud-vm-add-list-item p-2"
                                             data-ng-repeat="(distribution, images) in distributions track by $index">
                                            <div class="h-100"
                                                 data-ng-if="images.length === 1">
                                                <input class="oui-radio__input" type="radio" name="imageType" id="imageType_{{images[0].nameGeneric}}"
                                                       data-ng-model="$ctrl.model.imageType"
                                                       data-ng-value="images[0]">
                                                <label class="oui-radio__label-container d-inline-block h-100 w-100" for="imageType_{{images[0].nameGeneric}}">
                                                    <span class="oui-radio__label">
                                                        <span data-ng-bind="images[0].name"></span>
                                                        <sup data-ng-if="imageType === 'windows'">*</sup>
                                                    </span>
                                                    <span class="oui-radio__description"
                                                          data-translate="cpcivm_add_step1_distribution_last_version">
                                                    </span>
                                                </label>
                                            </div>
                                            <div class="h-100"
                                                 data-ng-if="images.length > 1">
                                                <div class="oui-radio__label-container d-inline-block h-100 w-100">
                                                    <div class="oui-radio__label pl-0">
                                                        <span data-ng-bind=":: 'cpcivm_add_distribution_' + distribution | translate"></span>
                                                        <sup data-ng-if="imageType === 'windows'">*</sup>
                                                    </div>
                                                    <div class="oui-radio__description">
                                                        <oui-action-menu data-text="{{ 'cpcivm_add_step1_distribution_choose' | translate }}"
                                                                         data-align="start">
                                                            <oui-action-menu-item data-text="{{ image.name }}"
                                                                                  data-on-click="$ctrl.model.imageType = image"
                                                                                  data-ng-repeat="image in images track by image.nameGeneric">
                                                            </oui-action-menu-item>
                                                        </oui-action-menu>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <p><sup aria-hidden="true">*</sup> <span data-translate="cpcivm_add_step1_windows_message"></span></p>
                            </uib-tab>
                            <uib-tab index="1" heading="{{ 'cpcivm_add_step1_tab_apps' | translate }}"
                                     data-ng-if="$ctrl.displayedApps.length > 0">
                                <div class="mt-4">
                                    <div class="cloud-vm-add-list d-md-flex flex-wrap">
                                        <div class="oui-radio oui-radio_thumbnail cloud-vm-add-list-item p-2"
                                             data-ng-repeat="app in $ctrl.displayedApps track by app.nameGeneric">
                                            <input class="oui-radio__input" type="radio" name="imageType" id="imageType_{{app.nameGeneric}}"
                                                   data-ng-model="$ctrl.model.imageType"
                                                   data-ng-value="app">
                                            <label class="oui-radio__label-container" for="imageType_{{app.nameGeneric}}">
                                            <span class="oui-radio__label"
                                                  data-ng-bind="app.name"></span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </uib-tab>
                            <uib-tab index="2" heading="{{ 'cpcivm_add_step1_tab_customs' | translate }}"
                                     data-ng-if="$ctrl.displayedCustoms.length > 0">
                                <div class="mt-4">
                                    Customs images
                                </div>
                            </uib-tab>
                            <uib-tab index="3" heading="{{ 'cpcivm_add_step1_tab_shapshots' | translate }}"
                                     data-ng-if="$ctrl.displayedSnapshots.length > 0">
                                <div class="mt-4">
                                    <div class="cloud-vm-add-list d-md-flex flex-wrap">
                                        <div class="oui-radio oui-radio_thumbnail cloud-vm-add-list-item p-2"
                                             data-ng-repeat="snapshot in $ctrl.displayedSnapshots track by snapshot.id">
                                            <input class="oui-radio__input" type="radio" name="snapshot" id="snapshot_{{snapshot.id}}"
                                                   data-ng-model="$ctrl.model.imageType"
                                                   data-ng-value="snapshot">
                                            <label class="oui-radio__label-container" for="snapshot_{{snapshot.id}}">
                                            <span class="oui-radio__label"
                                                  data-ng-bind="snapshot.name"></span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </uib-tab>
                        </uib-tabset>
                    </div>

                    <div data-ng-if="$ctrl.model.imageType">
                        <div class="oui-field">
                            <div class="oui-field__content">
                                <div class="oui-field-control_m">
                                    <div class="oui-box">
                                        <strong data-ng-bind=":: 'cpcivm_add_distribution_' + $ctrl.model.imageType.distribution | translate"></strong>
                                        <p data-ng-bind="$ctrl.model.imageType.name"></p>
                                    </div>
                                </div>
                                <div class="oui-field-helper oui-field-helper_top">
                                    <oui-button data-variant="secondary"
                                                data-text="{{ 'common_modify' | translate }}"
                                                data-on-click="$ctrl.resetStep1()">
                                    </oui-button>
                                </div>
                            </div>
                        </div>
                        <div data-ng-if="$ctrl.model.imageType.type === 'linux'">
                            <label class="oui-label" for="sshKey"
                                   data-translate="cpcivm_add_step1_sshKey_label">
                            </label>
                            <p data-translate="cpcivm_add_step1_sshKey_info"></p>
                            <div class="oui-field"
                                 data-ng-if="!$ctrl.addingSshKey">
                                <div class="oui-field__content">
                                    <div class="oui-field-control oui-field-control_m">
                                        <label class="oui-select">
                                            <select class="oui-select__input" id="sshKey" name="sshKey"
                                                    data-ng-change="$ctrl.checkSshKeyByRegion($ctrl.model.sshKey.regions)"
                                                    data-ng-disabled="$ctrl.model.region"
                                                    data-ng-model="$ctrl.model.sshKey"
                                                    data-ng-options="sshKey.name for sshKey in $ctrl.displayedSshKeys track by sshKey.id">
                                                <option value="" disabled
                                                        data-translate="common_select"></option>
                                            </select>
                                            <span class="oui-icon oui-icon-chevron-down" aria-hidden="true"></span>
                                        </label>
                                    </div>
                                    <div class="oui-field-helper oui-field-helper_top mb-0">
                                        <oui-button data-variant="secondary"
                                                    data-text="{{ 'cpcivm_add_step1_sshKey_add' | translate }}"
                                                    data-on-click="$ctrl.addingSshKey = true">
                                        </oui-button>
                                    </div>
                                </div>
                            </div>
                            <div data-ng-if="$ctrl.addingSshKey">
                                <div class="oui-field">
                                    <div class="oui-field__content">
                                        <div class="oui-field-control oui-field-control_m">
                                            <input type="text" class="oui-input" id="sshKey" placeholder="{{ 'cpcivm_add_step1_sshKey_name_placeholder' | translate }}"
                                                   data-ng-change=""
                                                   data-ng-disabled="$ctrl.loaders.addingSsh"
                                                   data-ng-model="$ctrl.newSshKey.name">
                                        </div>
                                    </div>
                                </div>
                                <div class="oui-field">
                                    <div class="oui-field__content align-items-stretch">
                                        <div class="oui-field-control oui-field-control_m">
                                            <textarea class="oui-textarea" id="sshKeyValue" rows="5" placeholder="{{ 'cpcivm_add_step1_sshKey_publicKey_placeholder' | translate }}" aria-describedby="sshKeyMessage"
                                                      data-ng-disabled="$ctrl.loaders.addingSsh"
                                                      data-ng-model="$ctrl.newSshKey.publicKey">
                                            </textarea>
                                        </div>
                                        <div class="oui-field-helper d-flex flex-column justify-content-between mb-0">
                                            <p id="sshKeyMessage">
                                                <span data-translate="cpcivm_add_step1_sshKey_message"></span><br>
                                                <a data-ng-href="{{$ctrl.urls.guidesSshkey}}" target="_blank"
                                                   data-translate="cpcivm_add_step1_sshKey_more"></a>.
                                            </p>
                                            <div>
                                                <oui-button data-variant="secondary"
                                                            data-type="submit"
                                                            data-text="{{ 'cpcivm_add_step1_sshKey_adding' | translate }}"
                                                            data-on-click="$ctrl.addSshKey()"
                                                            data-disabled="$ctrl.loaders.addingSsh">
                                                </oui-button>
                                                <oui-button data-variant="link"
                                                            data-text="{{ 'common_cancel' | translate }}"
                                                            data-on-click="$ctrl.resetAddingSshKey()">
                                                </oui-button>
                                                <oui-spinner data-ng-if="$ctrl.loaders.addingSsh"></oui-spinner>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <p data-translate="cpcivm_add_step1_sshKey_licence"></p>
                    </div>
                </cui-wizard-step>

                <!-- Step 2 : Regions -->
                <cui-wizard-step data-step-title="{{ 'cpcivm_add_step2_title' | translate }}"
                                 data-step-on-init="$ctrl.initRegionsAndDataCenters()"
                                 data-step-loaded="!$ctrl.loaders.step2"
                                 data-step-completed="$ctrl.isStep2Valid()">
                    <uib-tabset data-ng-if="!$ctrl.model.region">
                        <uib-tab index="0" heading="{{ 'cpcivm_add_step2_tab_all' | translate }}">
                            <div class="cloud-vm-add-list d-md-flex flex-wrap">
                                <!--<div class="oui-radio oui-radio_thumbnail cloud-vm-add-list-item p-2"-->
                                     <!--data-ng-if="$ctrl.displayedRegions.length > 1">-->
                                    <!--<input class="oui-radio__input" type="radio" name="region" id="region_auto" value="auto"-->
                                           <!--data-ng-model="$ctrl.model.region">-->
                                    <!--<label class="oui-radio__label-container d-inline-block h-100 w-100" for="region_auto">-->
                                        <!--<span class="oui-radio__label"-->
                                              <!--data-translate="cpcivm_add_step2_choose_auto"></span>-->
                                    <!--</label>-->
                                <!--</div>-->
                                <div class="oui-radio oui-radio_thumbnail cloud-vm-add-list-item p-2"
                                     data-ng-repeat="region in $ctrl.displayedRegions track by region.microRegion.code">
                                    <input class="oui-radio__input" type="radio" name="region" id="region_{{region.microRegion.code}}"
                                           data-ng-change="$ctrl.setImageId()"
                                           data-ng-disabled="region.disabled"
                                           data-ng-model="$ctrl.model.region"
                                           data-ng-value="region">
                                    <label class="oui-radio__label-container d-inline-block h-100 w-100" for="region_{{region.microRegion.code}}">
                                        <span class="oui-radio__label"
                                              data-ng-bind="region.macroRegion.text">
                                        </span>
                                        <span class="oui-radio__description text-center"
                                              data-ng-if="region.disabled">
                                            <oui-button data-variant="link"
                                                        data-text="{{'cpcivm_add_step2_disabled_' + region.disabled | translate}}"
                                                        data-on-click="$ctrl.updateSshKeyRegion()"
                                                        data-ng-if="$ctrl.model.sshKey && region.disabled === 'SSH_KEY'">
                                            </oui-button>
                                            <span data-ng-bind=":: 'cpcivm_add_step2_disabled_' + region.disabled | translate"
                                                  data-ng-if="region.disabled !== 'SSH_KEY'">
                                            </span>
                                        </span>
                                    </label>
                                </div>
                            </div>
                        </uib-tab>
                        <uib-tab data-ng-repeat="(continent, regions) in $ctrl.groupedRegions track by $index"
                                 index="($index + 1)" heading="{{continent}}">
                            <div class="cloud-vm-add-list d-md-flex flex-wrap">
                                <div class="oui-radio oui-radio_thumbnail cloud-vm-add-list-item p-2"
                                     data-ng-repeat="region in regions track by region.microRegion.code">
                                    <input class="oui-radio__input" type="radio" name="region" id="region_{{region.microRegion.code}}"
                                           data-ng-disabled="region.disabled"
                                           data-ng-model="$ctrl.model.region"
                                           data-ng-value="region">
                                    <label class="oui-radio__label-container d-inline-block h-100 w-100" for="region_{{region.microRegion.code}}">
                                        <span class="oui-radio__label"
                                              data-ng-bind="region.macroRegion.text">
                                        </span>
                                        <span class="oui-radio__description text-center"
                                              data-ng-if="region.disabled">
                                            <oui-button data-variant="link"
                                                        data-text="{{'cpcivm_add_step2_disabled_' + region.disabled | translate}}"
                                                        data-on-click="$ctrl.updateSshKeyRegion()"
                                                        data-ng-if="$ctrl.model.sshKey && region.disabled === 'SSH_KEY'">
                                            </oui-button>
                                            <span data-translate="'cpcivm_add_step2_disabled_' + region.disabled"
                                                  data-ng-if="region.disabled !== 'SSH_KEY'">
                                            </span>
                                        </span>
                                    </label>
                                </div>
                            </div>
                        </uib-tab>
                    </uib-tabset>

                    <div class="oui-field"
                         data-ng-if="$ctrl.model.region">
                        <div class="oui-field__content">
                            <div class="oui-field-control oui-field-control_m">
                                <div class="oui-box mb-4"
                                     data-ng-if="$ctrl.model.region !== 'auto'">
                                    <strong class="d-block"
                                            data-ng-bind="$ctrl.model.region.macroRegion.text"></strong>
                                    <span data-ng-bind="$ctrl.model.region.microRegion.code"></span>
                                </div>
                                <!--<div class="oui-box mb-4"-->
                                     <!--data-ng-if="$ctrl.model.region === 'auto'">-->
                                    <!--<strong class="d-block">Automatic</strong>-->
                                <!--</div>-->
                            </div>
                            <div class="oui-field-helper oui-field-helper_top">
                                <oui-button data-variant="secondary"
                                            data-text="{{ 'common_modify' | translate }}"
                                            data-on-click="$ctrl.resetStep2()">
                                </oui-button>
                            </div>
                        </div>
                    </div>
                </cui-wizard-step>

                <!-- Step 3 : Instances -->
                <cui-wizard-step data-step-title="{{ 'cpcivm_add_step3_title' | translate }}"
                                 data-step-on-init="$ctrl.initInstanceAndConfiguration()"
                                 data-step-loaded="!$ctrl.loaders.step3"
                                 data-step-completed="$ctrl.isStep3Valid()">
                    <uib-tabset data-ng-if="!$ctrl.model.flavor">
                        <uib-tab data-ng-repeat="group in $ctrl.groupedFlavors track by group.category"
                                 index="$index" heading="{{ 'cpcivm_add_step3_category_' + group.category | translate }}">
                            <div class="cloud-vm-add-list d-md-flex flex-wrap">
                                <div class="oui-radio oui-radio_thumbnail cloud-vm-add-list-item p-2"
                                     data-ng-repeat="flavor in group.flavors track by flavor.id">
                                    <input class="oui-radio__input" type="radio" name="flavor" id="flavor_{{flavor.id}}"
                                           data-ng-change="$ctrl.setInstanceName()"
                                           data-ng-disabled="flavor.disabled"
                                           data-ng-model="$ctrl.model.flavor"
                                           data-ng-value="flavor">
                                    <label class="oui-radio__label-container d-inline-block h-100 w-100" for="flavor_{{flavor.id}}">
                                        <span class="oui-radio__label d-flex text-nowrap">
                                            <span data-ng-bind="flavor.name"></span>
                                            <span class="ml-auto"
                                                  data-ng-if="flavor.price">
                                                <strong class="d-block"
                                                        data-translate="cpci_vm_flavor_month"
                                                        data-translate-values="{ price: flavor.price.monthlyPrice.text || '?' }"></strong>
                                                <span class="d-block"
                                                      data-translate="cpci_vm_flavor_price"
                                                      data-translate-values="{ price: flavor.price.price.text || '?' }"></span>
                                            </span>
                                        </span>
                                        <span class="oui-radio__description">
                                            <span class="d-block">Ram : <span data-ng-bind="flavor.ram | bytes:0:false:'MB'"></span></span>
                                            <span class="d-block">Core : <span data-ng-bind="flavor.vcpus"></span> vCores (<span data-ng-bind="flavor.frequency"></span> GHz)</span>
                                            <span class="d-block">Disk : <span data-ng-bind="flavor.disk | bytes:2:false:'GB'"></span> <span data-ng-bind="flavor.diskType | uppercase"></span></span>
                                            <span class="d-block"
                                                  data-ng-if="flavor.outboundBandwidth">
                                                Transfert : <span data-ng-bind="flavor.outboundBandwidth"></span>
                                            </span>
                                        </span>
                                        <span class="oui-radio__description text-center"
                                              data-ng-if="flavor.disabled">
                                            <oui-button data-variant="link"
                                                        data-text="{{'cpcivm_add_step3_disabled_NOT_AVAILABLE' | translate}}"
                                                        data-on-click="$ctrl.VirtualMachineAddService.openQuotaModal('NOT_AVAILABLE', { regions: flavor.regions.join(', ') })"
                                                        data-ng-if="flavor.disabled === 'NOT_AVAILABLE'">
                                            </oui-button>
                                            <oui-button data-variant="link"
                                                        data-text="{{'cpcivm_add_step3_disabled_QUOTA_RAM' | translate}}"
                                                        data-on-click="$ctrl.VirtualMachineAddService.openQuotaModal('QUOTA_RAM', { quota: $ctrl.CloudFlavorService.getQuotaRam(flavor, $ctrl.quota) })"
                                                        data-ng-if="flavor.disabled === 'QUOTA_RAM'">
                                            </oui-button>
                                            <oui-button data-variant="link"
                                                        data-text="{{'cpcivm_add_step3_disabled_QUOTA_VCPUS' | translate}}"
                                                        data-on-click="$ctrl.VirtualMachineAddService.openQuotaModal('QUOTA_VCPUS', { quota: $ctrl.CloudFlavorService.getQuotaCore(flavor, $ctrl.quota) })"
                                                        data-ng-if="flavor.disabled === 'QUOTA_VCPUS'">
                                            </oui-button>
                                        </span>
                                    </label>
                                </div>
                            </div>
                        </uib-tab>
                    </uib-tabset>

                    <div data-ng-if="$ctrl.model.flavor">
                        <div class="oui-field">
                            <div class="oui-field__content">
                                <div class="oui-field-control oui-field-control_l">
                                    <div class="oui-box mb-4">
                                        <span class="d-flex text-nowrap">
                                            <strong data-ng-bind="$ctrl.model.flavor.name"></strong>
                                            <span class="ml-auto">
                                                <strong class="d-block"
                                                        data-translate="cpci_vm_flavor_month"
                                                        data-translate-values="{ price: $ctrl.model.flavor.price.monthlyPrice.text || '?' }"></strong>
                                                <span class="d-block"
                                                      data-translate="cpci_vm_flavor_price"
                                                      data-translate-values="{ price: $ctrl.model.flavor.price.price.text || '?' }"></span>
                                            </span>
                                        </span>
                                        <div>Ram : <span data-ng-bind="$ctrl.model.flavor.ram | bytes:0:false:'MB'"></span></div>
                                        <div>Core : <span data-ng-bind="$ctrl.model.flavor.vcpus"></span> vCores (<span data-ng-bind="$ctrl.model.flavor.frequency"></span> GHz)</div>
                                        <div>Disk : <span data-ng-bind="$ctrl.model.flavor.disk | bytes:2:false:'GB'"></span> <span data-ng-bind="$ctrl.model.flavor.diskType | uppercase"></span></div>
                                        <div data-ng-if="$ctrl.model.flavor.outboundBandwidth">Transfert : <span data-ng-bind="$ctrl.model.flavor.outboundBandwidth"></span></div>
                                    </div>
                                </div>
                                <div class="oui-field-helper oui-field-helper_top">
                                    <oui-button data-variant="secondary"
                                                data-text="{{ 'common_modify' | translate }}"
                                                data-on-click="$ctrl.resetStep3()">
                                    </oui-button>
                                </div>
                            </div>
                        </div>

                        <div class="oui-field">
                            <label class="oui-field__label oui-label" for="model-number"
                                   data-translate="cpcivm_add_step3_quantity_label"></label>
                            <p data-translate="cpcivm_add_step3_quantity_info"></p>
                            <div class="oui-field__control">
                                <oui-numeric id="model-number"
                                             data-name="number"
                                             data-min="1"
                                             data-max="$ctrl.model.flavor.maxInstance > 0 ? $ctrl.model.flavor.maxInstance : 1000"
                                             data-model="$ctrl.model.number">
                                </oui-numeric>
                            </div>
                            <div class="oui-field__helper"
                                 data-ng-if="$ctrl.model.flavor.maxInstance > 0"
                                 data-translate="cpcivm_add_step3_quantity_help"
                                 data-translate-values="{
                                    max: $ctrl.model.flavor.maxInstance,
                                    type: $ctrl.model.flavor.name,
                                    region: $ctrl.model.region.microRegion.text }">
                            </div>
                        </div>

                        <oui-field data-label="{{ 'cpcivm_add_step3_name_label' | translate }}"
                                   data-help-text="{{ 'cpcivm_add_step3_name_help' | translate }}">
                            <input class="oui-input" id="model-name" name="name" type="text" required
                                   data-ng-change="$ctrl.isNameUpdated = true"
                                   data-ng-model="$ctrl.model.name"
                                   data-ng-pattern="/^[a-zA-Z0-9_\.\-]+$/">
                        </oui-field>
                        <p data-translate="cpcivm_add_step3_name_additional"></p>

                        <div class="oui-box my-5">
                            <div class="d-flex align-items-center">
                                <div class="w-100">
                                    <label class="oui-label" for="model-postScript"
                                           data-translate="cpcivm_add_step3_postscript_label"></label>
                                    <textarea class="oui-textarea mb-0" id="model-postScript"
                                              data-ng-if="$ctrl.isPostScriptEnabled"
                                              data-ng-model="$ctrl.model.userData">
                                    </textarea>
                                    <p data-translate="cpcivm_add_step3_postscript_info"
                                       data-ng-if="!$ctrl.isPostScriptEnabled"></p>
                                </div>
                                <div class="pl-5"
                                     data-ng-if="!$ctrl.isPostScriptEnabled">
                                    <button type="button" class="oui-button oui-button_secondary mb-0"
                                            data-translate="common_add"
                                            data-ng-click="$ctrl.enablePostScript()">
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="oui-field"
                             data-ng-if="$ctrl.state.hasVRack">
                            <label class="oui-field__label oui-label" for="model-name"
                                   data-translate="cpcivm_add_step3_network_label"></label>
                            <p data-translate="cpcivm_add_step3_network_info"
                               data-translate-values="{ url: $ctrl.urls.vLansApiGuide }"></p>
                            <div class="oui-field__content">
                                <div class="oui-field-control oui-field-control_l">
                                    <label class="oui-select">
                                        <select class="oui-select__input" id="network" name="network" required
                                                data-ng-disabled="$ctrl.loaders.privateNetworks"
                                                data-ng-model="$ctrl.model.networkId">
                                            <option value="" disabled
                                                    data-translate="common_select"></option>
                                            <option value="none"
                                                    data-translate="cpcivm_add_step3_network_none"></option>
                                            <option data-ng-repeat="network in $ctrl.displayedPrivateNetworks track by network.id"
                                                    data-ng-bind="network.vlanId + ' - ' + network.name"
                                                    data-ng-value="network.id"></option>
                                        </select>
                                        <span class="oui-icon oui-icon-chevron-down" aria-hidden="true"></span>
                                    </label>
                                </div>
                                <div class="oui-field-helper">
                                    <oui-spinner size="s" data-ng-if="$ctrl.loaders.privateNetworks"></oui-spinner>
                                </div>
                            </div>
                        </div>
                    </div>
                </cui-wizard-step>

                <!-- Step 4 : Billing period -->
                <cui-wizard-step data-step-title="{{ 'cpcivm_add_step4_title' | translate }}"
                                 data-step-on-init="$ctrl.resetStep4()"
                                 data-step-completed="$ctrl.isStep4Valid()">
                    <div data-ng-if="!$ctrl.model.billingPeriod">
                        <p data-translate="cpcivm_add_step4_message"></p>
                        <div class="cloud-vm-add-list d-md-flex flex-wrap">
                            <div class="oui-radio oui-radio_thumbnail cloud-vm-add-list-item p-2"
                                 data-ng-repeat="period in $ctrl.enums.billingPeriods track by $index">
                                <input class="oui-radio__input" type="radio" name="billingPeriod" id="period_{{period}}"
                                       data-ng-model="$ctrl.model.billingPeriod"
                                       data-ng-value="period">
                                <label class="oui-radio__label-container d-inline-block h-100 w-100" for="period_{{period}}">
                                    <span class="oui-radio__label"
                                          data-ng-bind=":: 'cpcivm_add_step4_billing_period_' + period | translate">
                                    </span>
                                    <span class="oui-radio__description">
                                        <span data-ng-bind="($ctrl.model.number * $ctrl.model.flavor.price.price.value) | currency: $ctrl.CurrencyService.getCurrentCurrency(): 3"
                                              data-ng-if="period === 'hourly'"></span>
                                        <span data-ng-bind="($ctrl.model.number * $ctrl.model.flavor.price.monthlyPrice.value ) | currency: $ctrl.CurrencyService.getCurrentCurrency(): 2"
                                              data-ng-if="period === 'monthly'"></span>
                                    </span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="oui-field"
                         data-ng-if="$ctrl.model.billingPeriod">
                        <div class="oui-field__content">
                            <div class="oui-field-control oui-field-control_m">
                                <div class="oui-box">
                                    <strong class="d-block"
                                            data-ng-bind=":: 'cpcivm_add_step4_billing_period_' + $ctrl.model.billingPeriod | translate"></strong>
                                    <span data-ng-bind="($ctrl.model.number * $ctrl.model.flavor.price.price.value) | currency: $ctrl.CurrencyService.getCurrentCurrency(): 3"
                                          data-ng-if="$ctrl.model.billingPeriod === 'hourly'"></span>
                                    <span data-ng-bind="($ctrl.model.number * $ctrl.model.flavor.price.monthlyPrice.value ) | currency: $ctrl.CurrencyService.getCurrentCurrency(): 2"
                                          data-ng-if="$ctrl.model.billingPeriod === 'monthly'"></span>
                                </div>
                            </div>
                            <div class="oui-field-helper oui-field-helper_top">
                                <oui-button data-variant="secondary"
                                            data-text="{{ 'common_modify' | translate }}"
                                            data-on-click="$ctrl.resetStep4()">
                                </oui-button>
                            </div>
                        </div>
                    </div>
                </cui-wizard-step>
            </cui-wizard-form>
        </div>

        <div class="col-md-3 hidden-xs">
            <div class="oui-box">
                <h2 class="oui-header_2 text-center"
                    data-translate="cpcivm_add_summary_title"></h2>
                <div class="oui-list_steps oui-list_separated">
                    <ul class="oui-list__items">
                        <li class="oui-list__item oui-list__item_optional oui-list__item_checked"
                            data-ng-class="{ 'oui-list__item_complete': $ctrl.isStep1Valid() }">
                            <span class="oui-list__header"
                                  data-translate="cpcivm_add_summary_os"></span>
                            <span class="oui-list__description"
                                  data-translate="cpcivm_add_summary_undefined"
                                  data-ng-if="!$ctrl.model.imageType"></span>
                            <span class="oui-list__description"
                                  data-ng-bind="$ctrl.model.imageType.name"
                                  data-ng-if="$ctrl.model.imageType"></span>
                        </li>
                        <li class="oui-list__item oui-list__item_optional oui-list__item_checked"
                            data-ng-class="{ 'oui-list__item_complete': $ctrl.isStep2Valid() }">
                            <span class="oui-list__header"
                                  data-translate="cpcivm_add_summary_region"></span>
                            <span class="oui-list__description"
                                  data-translate="cpcivm_add_summary_undefined"
                                  data-ng-if="!$ctrl.model.region"></span>
                            <span class="oui-list__description"
                                  data-ng-bind="$ctrl.model.region.microRegion.text"
                                  data-ng-if="$ctrl.model.region"></span>
                        </li>
                        <li class="oui-list__item oui-list__item_optional oui-list__item_checked"
                            data-ng-class="{ 'oui-list__item_complete': $ctrl.model.flavor && $ctrl.model.number > 0 }">
                            <span class="oui-list__header"
                                  data-translate="cpcivm_add_summary_instance"></span>
                            <span class="oui-list__description"
                                  data-translate="cpcivm_add_summary_undefined"
                                  data-ng-if="!$ctrl.model.flavor"></span>
                            <span class="oui-list__description d-flex"
                                  data-ng-if="$ctrl.model.flavor">
                                <span data-ng-bind="$ctrl.model.flavor.name"></span>
                                <strong class="ml-auto"
                                        data-ng-bind="'x' + $ctrl.model.number"></strong>
                            </span>
                        </li>
                        <li class="oui-list__item oui-list__item_optional oui-list__item_checked"
                            data-ng-class="{ 'oui-list__item_complete': $ctrl.model.flavor && $ctrl.model.name }">
                            <span class="oui-list__header"
                                  data-translate="cpcivm_add_summary_name"></span>
                            <span class="oui-list__description"
                                  data-translate="cpcivm_add_summary_undefined"
                                  data-ng-if="!$ctrl.model.name"></span>
                            <span class="oui-list__description"
                                  data-ng-bind="$ctrl.model.name"
                                  data-ng-if="$ctrl.model.name"></span>
                        </li>
                        <li class="oui-list__item">
                            <h3 data-translate="cpcivm_add_summary_price_monthly"></h3>
                            <span class="oui-list__description"
                                  data-translate="cpcivm_add_summary_undefined"
                                  data-ng-if="!$ctrl.model.flavor.price"></span>
                            <span class="oui-list__description"
                                  data-ng-bind="($ctrl.model.number * $ctrl.model.flavor.price.monthlyPrice.value ) | currency: $ctrl.CurrencyService.getCurrentCurrency(): 2"
                                  data-ng-if="$ctrl.model.flavor.price"></span>
                            <h3 data-translate="cpcivm_add_summary_price_hourly"></h3>
                            <span class="oui-list__description"
                                  data-translate="cpcivm_add_summary_undefined"
                                  data-ng-if="!$ctrl.model.flavor.price"></span>
                            <span class="oui-list__description"
                                  data-ng-bind="($ctrl.model.number * $ctrl.model.flavor.price.price.value) | currency: $ctrl.CurrencyService.getCurrentCurrency(): 3"
                                  data-ng-if="$ctrl.model.flavor.price"></span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

</section>
